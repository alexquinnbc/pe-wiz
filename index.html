
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Prompt Studio & Learning Hub</title>
    <!--
        🌐 Project: AI Prompt Studio & Learning Hub (v2.1 - Separated Data)

        🎯 Goal:
        A comprehensive, interactive single-page web application that serves as both
        an educational tool for prompt engineering and a practical prompt builder.
        It includes an extensive library of pre-defined prompts, allows users to share
        learned concepts and generated prompts, and provides links to external resources.
        The application runs entirely in the browser from a single HTML file,
        loading its data from a separate JavaScript file (`app_data.js`).

        📖 Usage:
        - Ensure `index.html` and `app_data.js` are in the same directory.
        - Open `index.html` in any modern web browser.
        - Navigate between "Learn", "Build", "Library", and "Resources" sections.
        - "Learn": Expanded interactive wizard for prompt engineering techniques.
        - "Build": Construct prompts with component fields and parameter insights.
        - "Library": Browse ~150 pre-defined prompts, load into builder.
        - "Resources": Find links to useful external content.
        - Use "Copy" buttons for concepts/prompts.
        - Test suite is hidden by default; toggle visibility at the bottom.

        🏗️ Structure:
        - `index.html`: Contains HTML, CSS, and main application JavaScript logic.
        - `app_data.js`: Contains all wizard step content and prompt library data.

        💡 Key Features Implemented:
        - Data loaded from `app_data.js` for cleaner HTML.
        - Test suite output toggleable and hidden by default.
        - Expanded educational wizard with more advanced techniques.
        - Significantly expanded prompt library (~150 unique prompts).
        - New "Resources" view with functional links.

        ⚠️ Known Limitations:
        - Requires `app_data.js` to be present in the same directory.
        - While data is external, the file size of `app_data.js` is substantial.
        - Search/filter in the library is category + basic text search.
        - AI Studio parameter controls are educational and and don't execute prompts.
        - Test suite covers core features; UI interaction testing is basic.
    -->

    <style>
        :root {
            --primary-color: #1a73e8; /* Google Blue */
            --primary-dark: #125abc;
            --primary-light: #e8f0fe;
            --secondary-color: #34a853; /* Google Green */
            --accent-color: #fbbc05; /* Google Yellow */
            --text-color: #3c4043;
            --text-light: #5f6368;
            --bg-color: #f1f3f4;
            --surface-color: #ffffff;
            --border-color: #dadce0;
            --error-color: #d93025;
            --success-color: #1e8e3e;
            --font-family: 'Roboto', 'Segoe UI', Arial, sans-serif;
            --font-family-mono: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            --animation-duration: 0.25s;
            --border-radius: 8px;
            --box-shadow: 0 1px 2px 0 rgba(60,64,67,0.3), 0 1px 3px 1px rgba(60,64,67,0.15);
            --box-shadow-hover: 0 1px 3px 0 rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
        }

        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        html { font-size: 100%; scroll-behavior: smooth; background-color: var(--bg-color); }
        body {
            font-family: var(--font-family); line-height: 1.6; color: var(--text-color);
            background-color: var(--bg-color); display: flex; flex-direction: column;
            align-items: center; min-height: 100vh; padding: 1rem;
        }

        .app-container {
            background-color: var(--surface-color); border-radius: var(--border-radius);
            box-shadow: var(--box-shadow); width: 100%; max-width: 960px;
            margin-bottom: 1rem; display: flex; flex-direction: column; overflow: hidden;
        }

        .app-nav { display: flex; background-color: var(--primary-light); border-bottom: 1px solid var(--border-color); }
        .app-nav__button {
            flex-grow: 1; padding: 1rem 1.25rem; font-size: 0.95rem;
            font-weight: 500; color: var(--primary-dark); background-color: transparent;
            border: none; border-bottom: 3px solid transparent; cursor: pointer;
            transition: background-color var(--animation-duration) ease, border-color var(--animation-duration) ease;
            text-align: center; display: flex; align-items: center; justify-content: center; gap: 0.4rem;
        }
        .app-nav__button svg { width: 20px; height: 20px; flex-shrink: 0; }
        .app-nav__button:hover { background-color: rgba(26,115,232,0.1); }
        .app-nav__button--active { color: var(--primary-color); border-bottom-color: var(--primary-color); font-weight: 600; }
        .app-nav__button:focus-visible { outline: 2px solid var(--accent-color); outline-offset: -2px; }

        .app-content { padding: 1.5rem 2rem; min-height: 420px; }
        .app-view { display: none; }
        .app-view--active { display: block; animation: fadeIn var(--animation-duration) ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2, h3 { color: var(--primary-dark); margin-bottom: 0.75rem; font-weight: 500; }
        h1 { font-size: clamp(1.7rem, 5vw, 2.1rem); }
        h2 { font-size: clamp(1.35rem, 4vw, 1.7rem); }
        h3 { font-size: clamp(1.1rem, 3.5vw, 1.25rem); }

        p, ul, div.example, .form-group { margin-bottom: 1rem; }
        ul { list-style-position: outside; padding-left: 1.5rem; }
        li { margin-bottom: 0.4rem; }
        code {
            background-color: #e8eaed; padding: 0.2em 0.4em; border-radius: 4px;
            font-family: var(--font-family-mono); font-size: 0.9em; color: var(--text-color);
        }
        strong { font-weight: 600; }
        .example {
            background-color: #f8f9fa; border: 1px solid var(--border-color);
            border-left: 4px solid var(--secondary-color); padding: 1rem;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
        }
        .example strong { color: var(--primary-color); }

        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;
            padding: 0.65rem 1.25rem; font-size: 0.95rem; font-weight: 500;
            border-radius: var(--border-radius); border: 1px solid transparent; cursor: pointer;
            transition: background-color var(--animation-duration) ease, border-color var(--animation-duration) ease, box-shadow var(--animation-duration) ease, transform 0.1s ease;
            text-decoration: none; white-space: nowrap;
        }
        .btn:focus-visible { outline: 2px solid var(--accent-color); outline-offset: 2px; }
        .btn:active { transform: scale(0.98); }
        .btn--primary { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }
        .btn--primary:hover:not(:disabled) { background-color: var(--primary-dark); border-color: var(--primary-dark); box-shadow: 0 1px 2px 0 rgba(26,115,232,0.3), 0 1px 3px 1px rgba(60,64,67,0.15); }
        .btn--secondary { background-color: var(--surface-color); color: var(--primary-color); border-color: var(--border-color); }
        .btn--secondary:hover:not(:disabled) { background-color: var(--primary-light); border-color: var(--primary-color); }
        .btn--icon { padding: 0.5rem; min-width: auto; }
        .btn svg { width: 18px; height: 18px; fill: currentColor; }
        .btn:disabled { background-color: #e0e0e0; border-color: #e0e0e0; color: #9e9e9e; cursor: not-allowed; box-shadow: none; }

        .form-group { margin-bottom: 1.25rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-light); }
        .form-control {
            width: 100%; padding: 0.75rem 1rem; font-size: 1rem; font-family: var(--font-family);
            line-height: 1.5; color: var(--text-color); background-color: var(--surface-color);
            border: 1px solid var(--border-color); border-radius: var(--border-radius);
            transition: border-color var(--animation-duration) ease, box-shadow var(--animation-duration) ease;
        }
        .form-control:focus { border-color: var(--primary-color); outline: 0; box-shadow: 0 0 0 0.2rem rgba(26,115,232,0.25); }
        textarea.form-control { min-height: 100px; resize: vertical; }
        select.form-control {
            appearance: none; background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 0.75rem center; background-size: 16px 12px; padding-right: 2.5rem;
        }

        .tooltip-container { position: relative; display: inline-block; }
        .tooltip-icon {
            cursor: help; color: var(--text-light); margin-left: 0.3rem; font-size: 0.9em;
            border: 1px solid var(--border-color); border-radius: 50%; width: 18px; height: 18px;
            display: inline-flex; align-items: center; justify-content: center; vertical-align: middle;
        }
        .tooltip-text {
            visibility: hidden; width: 220px; background-color: var(--text-color); color: #fff;
            text-align: center; border-radius: var(--border-radius); padding: 8px; position: absolute;
            z-index: 10; bottom: 125%; left: 50%; margin-left: -110px; opacity: 0;
            transition: opacity var(--animation-duration) ease; font-size: 0.85rem; line-height: 1.4;
        }
        .tooltip-text::after {
            content: ""; position: absolute; top: 100%; left: 50%; margin-left: -5px;
            border-width: 5px; border-style: solid; border-color: var(--text-color) transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text, .tooltip-icon:focus + .tooltip-text { visibility: visible; opacity: 1; }

        #learnView .wizard-header { background-color: var(--primary-color); color: white; padding: 1rem 1.5rem; text-align: center; border-radius: var(--border-radius) var(--border-radius) 0 0; }
        #learnView .wizard-header__title { font-size: 1.5rem; margin-bottom: 0.5rem; color: white; }
        #learnView .wizard-progress { background-color: rgba(255,255,255,0.2); border-radius: 4px; height: 8px; overflow: hidden; }
        #learnView .wizard-progress__bar { background-color: var(--accent-color); height: 100%; width: 0%; transition: width var(--animation-duration) ease-in-out; border-radius: 4px; }
        #learnView .wizard-steps { min-height: 300px; position: relative; overflow: hidden; padding: 1.5rem 0; }
        #learnView .wizard-step { opacity: 0; position: absolute; top: 1.5rem; left: 0; right: 0; visibility: hidden; transform: translateX(20px); transition: opacity var(--animation-duration) ease-in-out, transform var(--animation-duration) ease-in-out, visibility 0s var(--animation-duration); }
        #learnView .wizard-step--active { opacity: 1; visibility: visible; transform: translateX(0); position: relative; top:0; transition-delay: 0s, 0s, 0s; }
        #learnView .wizard-step--exiting-next { opacity: 0; transform: translateX(-20px); }
        #learnView .wizard-step--exiting-prev { opacity: 0; transform: translateX(20px); }
        #learnView .wizard-step__title { font-size: 1.3rem; color: var(--primary-color); margin-bottom: 1rem; }
        #learnView .wizard-navigation { display: flex; justify-content: space-between; align-items: center; padding-top: 1.5rem; border-top: 1px solid var(--border-color); }
        #learnView .wizard-step-indicator { font-size: 0.9rem; color: var(--text-light); }
        #learnView .action-bar { margin-top: 1rem; text-align: right; }

        #buildView .builder-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        #buildView .prompt-components, #buildView .parameter-controls { border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 1.5rem; background-color: #fcfcfc; }
        #buildView h3 { margin-top: 0; }
        #buildView .parameter-item { display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem; }
        #buildView .parameter-item label { margin-bottom: 0; flex-basis: 40%; }
        #buildView .parameter-item input[type="range"] { flex-grow: 1; margin: 0 0.5rem; }
        #buildView .parameter-item .param-value { font-weight: 500; min-width: 30px; text-align: right; }
        #buildView .assembled-prompt { margin-top: 1.5rem; padding: 1.5rem; border: 1px solid var(--secondary-color); border-radius: var(--border-radius); background-color: var(--primary-light); }
        #buildView .assembled-prompt pre { white-space: pre-wrap; word-wrap: break-word; font-family: var(--font-family-mono); font-size: 0.95rem; max-height: 200px; overflow-y: auto; background-color: var(--surface-color); padding: 0.75rem; border-radius: 4px; }
        #buildView .builder-actions { margin-top: 1.5rem; display: flex; gap: 0.75rem; justify-content: flex-end;}

        #libraryView .library-controls { display: flex; gap: 1rem; margin-bottom: 1.5rem; align-items: center; }
        #libraryView .prompt-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; }
        .prompt-card { border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: 1.25rem; background-color: var(--surface-color); display: flex; flex-direction: column; transition: box-shadow var(--animation-duration) ease; }
        .prompt-card:hover { box-shadow: var(--box-shadow-hover); }
        .prompt-card__title { font-size: 1.1rem; color: var(--primary-color); margin-bottom: 0.5rem; font-weight: 600;}
        .prompt-card__category { font-size: 0.8rem; color: var(--text-light); margin-bottom: 0.5rem; background-color: var(--primary-light); color: var(--primary-dark); padding: 0.2rem 0.5rem; border-radius: 4px; display: inline-block; }
        .prompt-card__description { font-size: 0.9rem; margin-bottom: 1rem; flex-grow: 1; }
        .prompt-card__actions { margin-top: auto; display: flex; gap: 0.5rem; }

        #resourcesView ul { list-style-type: disc; padding-left: 1.5rem; }
        #resourcesView li { margin-bottom: 0.75rem; }
        #resourcesView a { color: var(--primary-color); text-decoration: none; }
        #resourcesView a:hover { text-decoration: underline; color: var(--primary-dark); }
        #resourcesView .resource-category { margin-top: 1.5rem; margin-bottom: 0.5rem; font-size: 1.1rem; font-weight: 600; color: var(--secondary-color); }

        .test-output-container { width: 100%; max-width: 960px; margin: 1rem auto 0 auto; }
        .test-output-header { display:flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
        .test-output-header .test-output__title { margin-bottom: 0; }
        #toggleTestsBtn { font-size: 0.85rem; color: var(--primary-color); background: none; border: none; cursor: pointer; padding: 0.25rem 0.5rem; }
        #toggleTestsBtn:hover { text-decoration: underline; }

        .test-output {
             display: none; /* Hidden by default */
            background-color: var(--surface-color); border: 1px solid var(--border-color);
            border-radius: var(--border-radius); padding: 1rem;
            font-family: var(--font-family-mono); font-size: 0.85rem;
        }
        .test-output--visible { display: block; }
        .test-output__pre { white-space: pre-wrap; word-wrap: break-word; max-height: 300px; overflow-y: auto; background-color: #202124; color: #e8eaed; padding: 0.75rem; border-radius: 4px; }
        .test-output__pre .pass { color: #81c995; }
        .test-output__pre .fail { color: #f28b82; font-weight: bold; }
        .test-output__pre .info { color: #8ab4f8; }
        .test-output__pre .suite { color: var(--accent-color); font-weight: bold; margin-top: 0.5em; display: block; }

        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border-width: 0; }
        .toast-message {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background-color: var(--text-color); color: white; padding: 10px 20px;
            border-radius: var(--border-radius); box-shadow: var(--box-shadow);
            z-index: 1000; opacity: 0; transition: opacity 0.3s ease, bottom 0.3s ease; font-size: 0.9rem;
        }
        .toast-message.show { opacity: 1; bottom: 30px; }

        @media (max-width: 768px) {
            body { padding: 0.5rem; }
            .app-content { padding: 1rem 1.25rem; }
            .app-nav__button { padding: 0.75rem 0.25rem; font-size: 0.85rem; gap: 0.2rem; }
            .app-nav__button svg { width: 18px; height: 18px;}
            .app-nav__button span.nav-text { display: none; }
            @media (min-width: 420px) { .app-nav__button span.nav-text { display: inline; } }
            #learnView .wizard-navigation { flex-direction: column-reverse; gap: 0.75rem; }
            #learnView .wizard-navigation .btn { width: 100%; }
            #libraryView .library-controls { flex-direction: column; align-items: stretch; }
        }
        @media (max-width: 480px) {
            h1 { font-size: 1.5rem; } h2 { font-size: 1.25rem; }
            .btn { padding: 0.6rem 1rem; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="app-nav" aria-label="Main application navigation">
            <button id="navLearn" class="app-nav__button app-nav__button--active" data-view="learnView" aria-current="page">
                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12 3L2 9L12 15L22 9L12 3M4 10.5V17.8C4 18.1 4.2 18.4 4.5 18.5L11.5 22.4C11.8 22.5 12.2 22.5 12.5 22.4L19.5 18.5C19.8 18.4 20 18.1 20 17.8V10.5L12 16L4 10.5Z"></path></svg>
                <span class="nav-text">Learn</span>
            </button>
            <button id="navBuild" class="app-nav__button" data-view="buildView">
                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.13,5.12L18.88,8.87M3,17.25V21H6.75L17.81,9.94L14.06,6.19L3,17.25Z"></path></svg>
                <span class="nav-text">Build</span>
            </button>
            <button id="navLibrary" class="app-nav__button" data-view="libraryView">
                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M4,6H2V20A2,2 0 0,0 4,22H18V20H4V6M20,2H8A2,2 0 0,0 6,4V16A2,2 0 0,0 8,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M12,14.5V4.5L18,9.5L12,14.5Z"></path></svg>
                <span class="nav-text">Library</span>
            </button>
            <button id="navResources" class="app-nav__button" data-view="resourcesView">
                <svg viewBox="0 0 24 24"><path fill="currentColor" d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M17.5,17.5L14.1,15.6C14.6,14.7 15,13.7 15,12.5C15,9.2 12.3,6.5 9,6.5C5.7,6.5 3,9.2 3,12.5C3,15.8 5.7,18.5 9,18.5C10.4,18.5 11.7,18.1 12.8,17.4L16.2,19.8L17.5,17.5M9,16.5C6.8,16.5 5,14.7 5,12.5C5,10.3 6.8,8.5 9,8.5C11.2,8.5 13,10.3 13,12.5C13,14.7 11.2,16.5 9,16.5Z" /></svg>
                <span class="nav-text">Resources</span>
            </button>
        </nav>

        <main class="app-content">
            <!-- Learn View (Wizard) -->
            <section id="learnView" class="app-view app-view--active" role="tabpanel" aria-labelledby="navLearn">
                <header class="wizard-header">
                    <h1 class="wizard-header__title">Advanced Prompt Engineering Guide</h1>
                    <div class="wizard-progress" aria-label="Wizard progress">
                        <div class="wizard-progress__bar" id="wizardProgressBar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </header>
                <div class="wizard-steps" id="wizardStepsContainer" aria-live="polite"></div>
                <footer class="wizard-navigation">
                    <button id="wizardPrevBtn" class="btn btn--secondary">
                        <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
                        Previous
                    </button>
                    <span id="wizardStepIndicator" class="wizard-step-indicator">Step 1 / N</span>
                    <button id="wizardNextBtn" class="btn btn--primary">
                        Next
                        <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
                    </button>
                </footer>
            </section>

            <!-- Build View -->
            <section id="buildView" class="app-view" role="tabpanel" aria-labelledby="navBuild" hidden>
                 <h2>Prompt Builder</h2>
                <p>Construct your prompt using components and explore parameter effects (educational). Hover <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Click for info!</span></span> for tips.</p>
                <div class="builder-grid">
                    <div class="prompt-components">
                        <h3>Core Components</h3>
                        <div class="form-group"><label for="promptPersona">Persona / Role <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Define AI's persona (e.g., "expert botanist"). Sets tone/style.</span></span></label><input type="text" id="promptPersona" class="form-control" placeholder="e.g., A helpful AI assistant"></div>
                        <div class="form-group"><label for="promptInstruction">Instruction <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">The main task (e.g., "Summarize this text"). Be clear.</span></span></label><textarea id="promptInstruction" class="form-control" rows="3" placeholder="e.g., Explain photosynthesis"></textarea></div>
                        <div class="form-group"><label for="promptContext">Context <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Background info (e.g., "target audience: beginners").</span></span></label><textarea id="promptContext" class="form-control" rows="2" placeholder="e.g., For 5th graders"></textarea></div>
                        <div class="form-group"><label for="promptInputData">Input Data / Question <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Specific text/question for the instruction.</span></span></label><textarea id="promptInputData" class="form-control" rows="3" placeholder="e.g., [Paste text here]"></textarea></div>
                        <div class="form-group"><label for="promptExamples">Examples (Few-Shot) <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Input/output pairs to guide AI. E.g., Q: ... A: ...</span></span></label><textarea id="promptExamples" class="form-control" rows="3" placeholder="e.g., English: Hello -> French: Bonjour"></textarea></div>
                        <div class="form-group"><label for="promptOutputFormat">Output Format Indicator <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Desired output structure (e.g., "JSON format," "bullet list").</span></span></label><input type="text" id="promptOutputFormat" class="form-control" placeholder="e.g., Respond in JSON"></div>
                    </div>
                    <div class="parameter-controls">
                        <h3>AI Studio Parameters (Educational)</h3>
                        <p>These settings influence AI generation. They don't run prompts here but aid understanding.</p>
                        <div class="form-group parameter-item"><label for="paramTemperature">Temperature (0-1) <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Controls randomness. Low (0.2) = focused; High (0.8) = creative.</span></span></label><input type="range" id="paramTemperature" class="form-control" min="0" max="1" step="0.1" value="0.7"><span class="param-value" id="paramTemperatureValue">0.7</span></div>
                        <div class="form-group parameter-item"><label for="paramTopK">Top-K (1-100) <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Considers K most probable next tokens. Lower = narrower choices.</span></span></label><input type="range" id="paramTopK" class="form-control" min="1" max="100" step="1" value="40"><span class="param-value" id="paramTopKValue">40</span></div>
                        <div class="form-group parameter-item"><label for="paramTopP">Top-P (0-1) <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Nucleus sampling. Considers tokens for cumulative probability P.</span></span></label><input type="range" id="paramTopP" class="form-control" min="0" max="1" step="0.01" value="0.95"><span class="param-value" id="paramTopPValue">0.95</span></div>
                        <div class="form-group parameter-item"><label for="paramMaxTokens">Max Output Tokens <span class="tooltip-container"><span class="tooltip-icon" tabindex="0">?</span><span class="tooltip-text">Max tokens (words/sub-words) in AI response.</span></span></label><input type="number" id="paramMaxTokens" class="form-control" min="1" max="2048" step="1" value="256" style="max-width: 100px; text-align: right; padding-right: 0.5rem;"></div>
                    </div>
                </div>
                <div class="assembled-prompt"><h3>Assembled Prompt Preview</h3><pre id="assembledPromptPre">Your prompt appears here...</pre></div>
                <div class="builder-actions">
                    <button id="clearPromptBtn" class="btn btn--secondary">Clear All</button>
                    <button id="copyPromptBtn" class="btn btn--primary"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg>Copy Prompt</button>
                </div>
            </section>

            <!-- Library View -->
            <section id="libraryView" class="app-view" role="tabpanel" aria-labelledby="navLibrary" hidden>
                <h2>Prompt Library</h2>
                <p>Explore ~150 prompts for common tasks. Load one into the builder to customize.</p>
                <div class="library-controls">
                    <div class="form-group" style="flex-grow: 1;"><label for="promptCategoryFilter">Filter by Category:</label><select id="promptCategoryFilter" class="form-control"><option value="all">All Categories</option></select></div>
                    <div class="form-group" style="flex-grow: 2;"><label for="promptSearch">Search Prompts (titles & descriptions):</label><input type="search" id="promptSearch" class="form-control" placeholder="e.g., email, summarize, code..."></div>
                </div>
                <div id="promptListContainer" class="prompt-list"><p id="noPromptsMessage" style="display:none;">No prompts found.</p></div>
            </section>

            <!-- Resources View -->
            <section id="resourcesView" class="app-view" role="tabpanel" aria-labelledby="navResources" hidden>
                <h2>Prompt Engineering Resources</h2>
                <p>Explore these valuable resources to deepen your understanding of prompt engineering:</p>
                
                <h3 class="resource-category">Official Guides & Documentation</h3>
                <ul>
                    <li><a href="https://developers.google.com/machine-learning/resources/prompt-eng" target="_blank" rel="noopener">Google AI: Prompt design</a></li>
                    <li><a href="https://cloud.google.com/vertex-ai/docs/generative-ai/learn/introduction-prompt-design" target="_blank" rel="noopener">Google Cloud: Introduction to prompt design</a></li>
                    <li><a href="https://platform.openai.com/docs/guides/prompt-engineering" target="_blank" rel="noopener">OpenAI: Prompt engineering guide</a></li>
                    <li><a href="https://www.anthropic.com/news/intro-to-prompt-design" target="_blank" rel="noopener">Anthropic: Introduction to Prompt Design</a></li>
                </ul>

                <h3 class="resource-category">Courses & Learning Platforms</h3>
                <ul>
                    <li><a href="https://www.deeplearning.ai/short-courses/chatgpt-prompt-engineering-for-developers/" target="_blank" rel="noopener">DeepLearning.AI: ChatGPT Prompt Engineering for Developers</a></li>
                     <li><a href="https://learnprompting.org/" target="_blank" rel="noopener">LearnPrompting.org: Free Prompt Engineering Course</a></li>
                    <li><a href="https://www.coursera.org/learn/prompt-engineering" target="_blank" rel="noopener">Coursera: Prompt Engineering Specialization (Vanderbilt)</a></li>
                </ul>

                <h3 class="resource-category">Key Research Papers & Concepts</h3>
                <ul>
                    <li><a href="https://arxiv.org/abs/2201.11903" target="_blank" rel="noopener">Chain-of-Thought Prompting Elicits Reasoning in Large Language Models (Wei et al., 2022)</a></li>
                    <li><a href="https://arxiv.org/abs/2203.11171" target="_blank" rel="noopener">Self-Consistency Improves Chain of Thought Reasoning in Language Models (Wang et al., 2022)</a></li>
                    <li><a href="https://arxiv.org/abs/2205.11916" target="_blank" rel="noopener">Large Language Models are Zero-Shot Reasoners (Kojima et al., 2022 - "Let's think step by step")</a></li>
                     <li><a href="https://arxiv.org/abs/2302.00923" target="_blank" rel="noopener">Toolformer: Language Models Can Teach Themselves to Use Tools (Schick et al., 2023)</a></li>
                </ul>
                
                <h3 class="resource-category">Blogs & Communities</h3>
                <ul>
                    <li><a href="https://cobusgreyling.medium.com/" target="_blank" rel="noopener">Cobus Greyling on Medium (Practical Prompting)</a></li>
                    <li><a href="https://www.promptingguide.ai/" target="_blank" rel="noopener">Prompting Guide AI</a></li>
                    <li>Relevant Subreddits (e.g., r/PromptEngineering, r/LocalLLaMA - search for these)</li>
                </ul>
                <p style="margin-top: 1.5rem;"><em>Note: The field of prompt engineering is rapidly evolving. Always look for the latest information from reputable sources.</em></p>
            </section>
        </main>
    </div>

    <div class="test-output-container">
        <div class="test-output-header">
            <h2 class="test-output__title">Test Suite Results</h2>
            <button id="toggleTestsBtn" aria-expanded="false" aria-controls="testOutputSection">Show Tests</button>
        </div>
        <div id="testOutputSection" class="test-output" role="region" aria-labelledby="toggleTestsBtn">
            <pre id="testResultsPre" class="test-output__pre" aria-live="assertive"></pre>
        </div>
    </div>
    
    <div id="toast" class="toast-message">Copied to clipboard!</div>

    <!-- External data file loaded first -->
    <script src="app_data.js"></script>

    <!-- Main application logic -->
    <script>
    // --- Utils ---
    const Utils = (() => {
        function debounce(func, delay) { let timeout; return function(...args) { clearTimeout(timeout); timeout = setTimeout(() => func.apply(this, args), delay); }; }
        function copyToClipboard(text) {
            if (!navigator.clipboard) {
                const textArea = document.createElement("textarea");
                textArea.value = text; textArea.style.position = "fixed"; document.body.appendChild(textArea);
                textArea.focus(); textArea.select();
                try { document.execCommand('copy'); showToast("Copied (fallback)!"); }
                catch (err) { showToast("Failed to copy.", true); console.error('Fallback copy failed', err); }
                document.body.removeChild(textArea); return;
            }
            navigator.clipboard.writeText(text).then(() => { showToast("Copied to clipboard!"); })
                .catch(err => { showToast("Failed to copy.", true); console.error('Async copy failed', err); });
        }
        let toastTimeout;
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast'); if (!toast) return;
            toast.textContent = message;
            toast.style.backgroundColor = isError ? 'var(--error-color)' : 'var(--text-color)';
            toast.classList.add('show'); clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }
        function sanitizeHTML(str) { const temp = document.createElement('div'); temp.textContent = str; return temp.innerHTML; }
        return { debounce, copyToClipboard, showToast, sanitizeHTML };
    })();

    // --- UIManager ---
    const UIManager = (() => {
        const DOM = { navButtons: null, appViews: null, toggleTestsBtn: null, testOutputSection: null };
        function init() {
            DOM.navButtons = document.querySelectorAll('.app-nav__button');
            DOM.appViews = document.querySelectorAll('.app-view');
            DOM.toggleTestsBtn = document.getElementById('toggleTestsBtn');
            DOM.testOutputSection = document.getElementById('testOutputSection');

            DOM.navButtons.forEach(button => button.addEventListener('click', () => switchView(button.dataset.view, button)));
            
            if (DOM.toggleTestsBtn && DOM.testOutputSection) {
                DOM.toggleTestsBtn.addEventListener('click', toggleTestOutput);
                DOM.testOutputSection.classList.remove('test-output--visible'); // Start hidden
                DOM.toggleTestsBtn.setAttribute('aria-expanded', 'false');
                DOM.toggleTestsBtn.textContent = 'Show Tests';
            }
        }
        function switchView(viewId, clickedButton) {
            DOM.appViews.forEach(view => { view.classList.remove('app-view--active'); view.hidden = true; });
            const activeView = document.getElementById(viewId);
            if (activeView) { activeView.classList.add('app-view--active'); activeView.hidden = false; /* activeView.focus(); Consider if focus is needed/jarring */ }
            DOM.navButtons.forEach(btn => { btn.classList.remove('app-nav__button--active'); btn.setAttribute('aria-current', 'false'); });
            if (clickedButton) { clickedButton.classList.add('app-nav__button--active'); clickedButton.setAttribute('aria-current', 'page'); }
        }
        function toggleTestOutput() {
            const isVisible = DOM.testOutputSection.classList.toggle('test-output--visible');
            DOM.toggleTestsBtn.textContent = isVisible ? 'Hide Tests' : 'Show Tests';
            DOM.toggleTestsBtn.setAttribute('aria-expanded', isVisible.toString());
        }
        return { init, switchView };
    })();

    // --- EducationWizard ---
    const EducationWizard = (() => {
        const WIZARD_STEPS = APP_DATA_STORE.WIZARD_STEPS_DATA; // Get data from external store
        let currentStepIndex = 0; let activeStepElement = null;
        const DOM = { stepsContainer: null, prevBtn: null, nextBtn: null, stepIndicator: null, progressBar: null };

        function init() {
            DOM.stepsContainer = document.getElementById('wizardStepsContainer');
            DOM.prevBtn = document.getElementById('wizardPrevBtn');
            DOM.nextBtn = document.getElementById('wizardNextBtn');
            DOM.stepIndicator = document.getElementById('wizardStepIndicator');
            DOM.progressBar = document.getElementById('wizardProgressBar');
            if (!DOM.stepsContainer || !DOM.prevBtn || !DOM.nextBtn) { console.error("Wizard elements missing!"); return; }
            DOM.prevBtn.addEventListener('click', prevStep);
            DOM.nextBtn.addEventListener('click', nextStep);
            renderStep(currentStepIndex);
        }
        function renderStep(index, direction = 'next') {
            if (index < 0 || index >= WIZARD_STEPS.length) return;
            const stepData = WIZARD_STEPS[index];
            const newStepEl = document.createElement('div');
            newStepEl.classList.add('wizard-step'); newStepEl.setAttribute('role', 'tabpanel');
            newStepEl.innerHTML = `<h3 class="wizard-step__title">${stepData.title}</h3><div class="wizard-step__content">${stepData.content}</div><div class="action-bar"><button class="btn btn--secondary btn--icon copy-concept-btn" title="Copy this concept"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg>Copy Concept</button></div>`;
            newStepEl.querySelector('.copy-concept-btn').addEventListener('click', () => { Utils.copyToClipboard(`Concept: ${stepData.title}\n\n${newStepEl.querySelector('.wizard-step__content').innerText}`); });
            if (activeStepElement) {
                activeStepElement.classList.remove('wizard-step--active');
                activeStepElement.classList.add(direction === 'next' ? 'wizard-step--exiting-next' : 'wizard-step--exiting-prev');
                activeStepElement.addEventListener('transitionend', () => { if (activeStepElement && activeStepElement.parentNode === DOM.stepsContainer && !activeStepElement.classList.contains('wizard-step--active')) { DOM.stepsContainer.removeChild(activeStepElement); } }, { once: true });
            }
            DOM.stepsContainer.appendChild(newStepEl);
            requestAnimationFrame(() => { requestAnimationFrame(() => { newStepEl.classList.add('wizard-step--active'); }); });
            activeStepElement = newStepEl; currentStepIndex = index; updateNavigation();
        }
        function updateNavigation() {
            DOM.prevBtn.disabled = currentStepIndex === 0;
            DOM.nextBtn.disabled = currentStepIndex === WIZARD_STEPS.length - 1;
            DOM.stepIndicator.textContent = `Step ${currentStepIndex + 1} / ${WIZARD_STEPS.length}`;
            const progress = ((currentStepIndex + 1) / WIZARD_STEPS.length) * 100;
            DOM.progressBar.style.width = `${progress}%`;
            DOM.progressBar.setAttribute('aria-valuenow', Math.round(progress));
        }
        function nextStep() { if (currentStepIndex < WIZARD_STEPS.length - 1) renderStep(currentStepIndex + 1, 'next'); }
        function prevStep() { if (currentStepIndex > 0) renderStep(currentStepIndex - 1, 'prev'); }
        return { init, getCurrentStepIndex: () => currentStepIndex, getTotalSteps: () => WIZARD_STEPS.length };
    })();

    // --- PromptBuilder ---
    const PromptBuilder = (() => {
        const DOM = { persona: null, instruction: null, context: null, inputData: null, examples: null, outputFormat: null, tempSlider: null, tempValue: null, topKSlider: null, topKValue: null, topPSlider: null, topPValue: null, maxTokensInput: null, assembledPromptPre: null, copyPromptBtn: null, clearPromptBtn: null };
        function init() {
            DOM.persona = document.getElementById('promptPersona'); DOM.instruction = document.getElementById('promptInstruction'); DOM.context = document.getElementById('promptContext'); DOM.inputData = document.getElementById('promptInputData'); DOM.examples = document.getElementById('promptExamples'); DOM.outputFormat = document.getElementById('promptOutputFormat');
            DOM.tempSlider = document.getElementById('paramTemperature'); DOM.tempValue = document.getElementById('paramTemperatureValue'); DOM.topKSlider = document.getElementById('paramTopK'); DOM.topKValue = document.getElementById('paramTopKValue'); DOM.topPSlider = document.getElementById('paramTopP'); DOM.topPValue = document.getElementById('paramTopPValue'); DOM.maxTokensInput = document.getElementById('paramMaxTokens');
            DOM.assembledPromptPre = document.getElementById('assembledPromptPre'); DOM.copyPromptBtn = document.getElementById('copyPromptBtn'); DOM.clearPromptBtn = document.getElementById('clearPromptBtn');
            const inputsToWatch = [DOM.persona, DOM.instruction, DOM.context, DOM.inputData, DOM.examples, DOM.outputFormat, DOM.tempSlider, DOM.topKSlider, DOM.topPSlider, DOM.maxTokensInput];
            inputsToWatch.forEach(input => { if(input) input.addEventListener('input', Utils.debounce(updateAssembledPrompt, 200)); });
            if (DOM.tempSlider) DOM.tempSlider.addEventListener('input', () => DOM.tempValue.textContent = DOM.tempSlider.value);
            if (DOM.topKSlider) DOM.topKSlider.addEventListener('input', () => DOM.topKValue.textContent = DOM.topKSlider.value);
            if (DOM.topPSlider) DOM.topPSlider.addEventListener('input', () => DOM.topPValue.textContent = DOM.topPSlider.value);
            if (DOM.copyPromptBtn) DOM.copyPromptBtn.addEventListener('click', copyAssembledPrompt);
            if (DOM.clearPromptBtn) DOM.clearPromptBtn.addEventListener('click', clearAllFields);
            updateAssembledPrompt();
        }
        function updateAssembledPrompt() {
            let prompt = "";
            if (DOM.persona.value.trim()) prompt += `Persona: ${DOM.persona.value.trim()}\n\n`;
            if (DOM.instruction.value.trim()) prompt += `Instruction: ${DOM.instruction.value.trim()}\n\n`;
            if (DOM.context.value.trim()) prompt += `Context: ${DOM.context.value.trim()}\n\n`;
            if (DOM.inputData.value.trim()) prompt += `Input Data:\n'''\n${DOM.inputData.value.trim()}\n'''\n\n`;
            if (DOM.examples.value.trim()) prompt += `Examples:\n${DOM.examples.value.trim()}\n\n`;
            if (DOM.outputFormat.value.trim()) prompt += `Output Format: ${DOM.outputFormat.value.trim()}\n`;
            prompt = prompt.trim();
            DOM.assembledPromptPre.textContent = prompt || "Your constructed prompt will appear here...";
        }
        function copyAssembledPrompt() {
            const promptText = DOM.assembledPromptPre.textContent.split("--- Parameters")[0].trim();
            if (promptText && promptText !== "Your constructed prompt will appear here...") Utils.copyToClipboard(promptText);
            else Utils.showToast("Nothing to copy yet!", true);
        }
        function clearAllFields() {
            DOM.persona.value = ''; DOM.instruction.value = ''; DOM.context.value = ''; DOM.inputData.value = ''; DOM.examples.value = ''; DOM.outputFormat.value = '';
            DOM.tempSlider.value = 0.7; DOM.tempValue.textContent = 0.7; DOM.topKSlider.value = 40; DOM.topKValue.textContent = 40; DOM.topPSlider.value = 0.95; DOM.topPValue.textContent = 0.95; DOM.maxTokensInput.value = 256;
            updateAssembledPrompt();
        }
        function loadPromptIntoBuilder(promptData) {
            if (!promptData || !promptData.components) { Utils.showToast("Invalid prompt data.", true); return; }
            const { persona, instruction, context, inputData, examples, outputFormat } = promptData.components;
            DOM.persona.value = persona || ''; DOM.instruction.value = instruction || ''; DOM.context.value = context || ''; DOM.inputData.value = inputData || ''; DOM.examples.value = examples || ''; DOM.outputFormat.value = outputFormat || '';
            updateAssembledPrompt(); UIManager.switchView('buildView', document.getElementById('navBuild')); Utils.showToast("Prompt loaded into Builder!");
        }
        return { init, loadPromptIntoBuilder };
    })();

    // --- PromptLibrary ---
    const PromptLibrary = (() => {
        const ALL_PROMPTS = APP_DATA_STORE.PROMPT_LIBRARY_DATA; // Get data from external store
        const CATEGORIES = (() => { // Helper to get unique categories from the loaded data
            const categories = new Set(ALL_PROMPTS.map(p => p.category));
            return ['all', ...Array.from(categories).sort()];
        })();

        let currentFilter = 'all'; let currentSearchTerm = '';
        const DOM = { listContainer: null, categoryFilter: null, searchInput: null, noPromptsMessage: null };

        function init() {
            DOM.listContainer = document.getElementById('promptListContainer'); DOM.categoryFilter = document.getElementById('promptCategoryFilter'); DOM.searchInput = document.getElementById('promptSearch'); DOM.noPromptsMessage = document.getElementById('noPromptsMessage');
            populateCategoryFilter();
            DOM.categoryFilter.addEventListener('change', (e) => { currentFilter = e.target.value; renderPrompts(); });
            DOM.searchInput.addEventListener('input', Utils.debounce((e) => { currentSearchTerm = e.target.value.toLowerCase(); renderPrompts(); }, 300));
            renderPrompts();
        }
        function populateCategoryFilter() { CATEGORIES.forEach(category => { if (category === 'all') return; const option = document.createElement('option'); option.value = category; option.textContent = category; DOM.categoryFilter.appendChild(option); }); }
        function renderPrompts() {
            DOM.listContainer.innerHTML = ''; let filteredPrompts = ALL_PROMPTS;
            if (currentFilter !== 'all') filteredPrompts = filteredPrompts.filter(p => p.category === currentFilter);
            if (currentSearchTerm) filteredPrompts = filteredPrompts.filter(p => p.title.toLowerCase().includes(currentSearchTerm) || p.description.toLowerCase().includes(currentSearchTerm) || (p.tags && p.tags.some(tag => tag.toLowerCase().includes(currentSearchTerm))));
            DOM.noPromptsMessage.style.display = filteredPrompts.length === 0 ? 'block' : 'none';
            filteredPrompts.forEach(prompt => { DOM.listContainer.appendChild(createPromptCard(prompt)); });
        }
        function createPromptCard(promptData) {
            const card = document.createElement('div'); card.className = 'prompt-card';
            card.innerHTML = `<h3 class="prompt-card__title">${Utils.sanitizeHTML(promptData.title)}</h3><span class="prompt-card__category">${Utils.sanitizeHTML(promptData.category)}</span><p class="prompt-card__description">${Utils.sanitizeHTML(promptData.description)}</p><div class="prompt-card__actions"><button class="btn btn--secondary btn--icon load-prompt-btn" title="Load into Builder"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M9,3A2,2 0 0,1 11,1L14.5,2.5L13,6L9,3M11.5,4.5L10,6L13,9L14.5,7.5L11.5,4.5M6.5,6.5L3,10L6,13L7.5,11.5L4.5,8.5L6.5,6.5M19.5,6.5L16.5,8.5L18,10L21,6.5L19.5,6.5M10,13L11.5,14.5L8.5,17.5L7,16L10,13M13,10L16,13L14.5,14.5L11,11L13,10M18,13L17,14L15.5,12.5L16.5,11.5L18,13M15,16.5L13.5,18L17,21L20,18L15,16.5Z"></path></svg> Load</button><button class="btn btn--secondary btn--icon copy-raw-prompt-btn" title="Copy Raw Prompt"><svg viewBox="0 0 24 24"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg> Copy</button></div>`;
            card.querySelector('.load-prompt-btn').addEventListener('click', () => PromptBuilder.loadPromptIntoBuilder(promptData));
            card.querySelector('.copy-raw-prompt-btn').addEventListener('click', () => { Utils.copyToClipboard(promptData.prompt_template); });
            return card;
        }
        return { init };
    })();


    // --- Main App Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        // Basic check if data store is available (from app_data.js)
        if (typeof APP_DATA_STORE === 'undefined' || !APP_DATA_STORE.WIZARD_STEPS_DATA || !APP_DATA_STORE.PROMPT_LIBRARY_DATA) {
            console.error("APP_DATA_STORE not found or incomplete. Ensure app_data.js is correctly linked and populated.");
            const errorDiv = document.createElement('div');
            errorDiv.style.color = 'var(--error-color)';
            errorDiv.style.padding = '1rem';
            errorDiv.style.backgroundColor = 'var(--primary-light)';
            errorDiv.style.margin = '1rem auto';
            errorDiv.style.maxWidth = '960px';
            errorDiv.style.borderRadius = 'var(--border-radius)';
            errorDiv.innerHTML = '<h2>Application Error: Data Not Loaded</h2><p>Please ensure <code>app_data.js</code> is in the same directory as <code>index.html</code> and is correctly formatted.</p>';
            document.body.prepend(errorDiv);
            return; // Stop initialization if data is missing
        }

        UIManager.init();
        EducationWizard.init();
        PromptBuilder.init();
        PromptLibrary.init();
        // TestSuite will self-initialize as it's a module script (defined below)
    });

    </script>

    <!-- Test Suite Logic - Type Module allows isolated scope and imports (if needed) -->
    <script type="module" id="test-suite">
        // Reference external data store for tests
        // NOTE: In a true module system, APP_DATA_STORE would be exported/imported.
        // For simplicity in a flat file structure, we rely on it being globally available from app_data.js script tag.
        const APP_DATA = typeof APP_DATA_STORE !== 'undefined' ? APP_DATA_STORE : {};

        const testResultsPre = document.getElementById('testResultsPre');
        let testsRun = 0, testsPassed = 0, testsFailed = 0;

        function log(message, type = 'info') {
            const span = document.createElement('span');
            span.className = type;
            span.textContent = message + '\n';
            if (testResultsPre) {
                testResultsPre.appendChild(span);
                testResultsPre.scrollTop = testResultsPre.scrollHeight; // Auto-scroll
            } else {
                console.warn("Test results pre element not found. Logging to console only: " + message);
            }
        }

        function assert(condition, message) {
            testsRun++;
            if (condition) {
                log(`✅ PASS: ${message}`, 'pass');
                testsPassed++;
            } else {
                log(`❌ FAIL: ${message}`, 'fail');
                testsFailed++;
            }
        }

        async function runTests() {
            log('🚀 Starting Test Suite...\n', 'info');
            // Give the main app time to initialize and render initial DOM
            await new Promise(resolve => setTimeout(resolve, 200)); 

            log('\n--- Suite: Data Availability ---\n', 'suite');
            assert(typeof APP_DATA === 'object', 'APP_DATA object should exist');
            assert(Array.isArray(APP_DATA.WIZARD_STEPS_DATA) && APP_DATA.WIZARD_STEPS_DATA.length > 0, 'Wizard steps data should be an array and not empty');
            assert(Array.isArray(APP_DATA.PROMPT_LIBRARY_DATA) && APP_DATA.PROMPT_LIBRARY_DATA.length > 0, 'Prompt library data should be an array and not empty');
            
            log('\n--- Suite: Module Existence ---\n', 'suite');
            assert(typeof Utils === 'object' && Utils.copyToClipboard, 'Utils module exists and is functional');
            assert(typeof UIManager === 'object' && UIManager.switchView, 'UIManager module exists and is functional');
            assert(typeof EducationWizard === 'object' && EducationWizard.init, 'EducationWizard module exists and is functional');
            assert(typeof PromptBuilder === 'object' && PromptBuilder.init, 'PromptBuilder module exists and is functional');
            assert(typeof PromptLibrary === 'object' && PromptLibrary.init, 'PromptLibrary module exists and is functional');

            log('\n--- Suite: UIManager (Basic) ---\n', 'suite');
            const initialView = document.querySelector('.app-view--active');
            assert(initialView && initialView.id === 'learnView', `Initial active view should be 'learnView' (found: ${initialView ? initialView.id : 'none'})`);
            const navBuildBtn = document.getElementById('navBuild');
            if (navBuildBtn) {
                UIManager.switchView('buildView', navBuildBtn);
                await new Promise(resolve => setTimeout(resolve, 50)); 
                const currentActiveView = document.querySelector('.app-view--active');
                assert(currentActiveView && currentActiveView.id === 'buildView', `Switched view to 'buildView' successfully (found: ${currentActiveView ? currentActiveView.id : 'none'})`);
                // Switch back for other tests
                const navLearnBtn = document.getElementById('navLearn');
                if (navLearnBtn) UIManager.switchView('learnView', navLearnBtn); 
            } else {
                log('❌ FAIL: Navigation "Build" button not found, cannot test view switch.', 'fail'); testsFailed++;
            }
            
            const toggleTestsBtn = document.getElementById('toggleTestsBtn');
            const testOutputSection = document.getElementById('testOutputSection');
            assert(toggleTestsBtn !== null, "Test toggle button exists");
            assert(testOutputSection !== null && !testOutputSection.classList.contains('test-output--visible'), "Test output section initially hidden");
            if(toggleTestsBtn && testOutputSection) { 
                toggleTestsBtn.click();
                assert(testOutputSection.classList.contains('test-output--visible'), "Test output section visible after first click");
                toggleTestsBtn.click();
                assert(!testOutputSection.classList.contains('test-output--visible'), "Test output section hidden after second click");
            } else {
                 log('❌ FAIL: Test toggle button or output section not found for interaction test', 'fail'); testsFailed++;
            }
            
            log('\n--- Suite: EducationWizard (Basic) ---\n', 'suite');
            assert(EducationWizard.getCurrentStepIndex() === 0, 'Wizard starts at step 0');
            assert(EducationWizard.getTotalSteps() === APP_DATA.WIZARD_STEPS_DATA.length && EducationWizard.getTotalSteps() > 10, 'Wizard has expected number of expanded steps (more than 10)');
            const initialWizardStepEl = document.querySelector('#wizardStepsContainer .wizard-step--active');
            assert(initialWizardStepEl !== null, 'Initial wizard step element should be active');
            if (initialWizardStepEl) {
                assert(initialWizardStepEl.querySelector('.wizard-step__title').textContent.includes(APP_DATA.WIZARD_STEPS_DATA[0].title.substring(0, 10)), 'Initial wizard step content matches data');
            }


            log('\n--- Suite: PromptBuilder (Basic) ---\n', 'suite');
            const assembledPromptPre = document.getElementById('assembledPromptPre');
            assert(assembledPromptPre && assembledPromptPre.textContent.length > 0, 'PromptBuilder assembled prompt area exists');
            const promptInstructionInput = document.getElementById('promptInstruction');
            if (promptInstructionInput) {
                promptInstructionInput.value = "Test instruction for prompt builder.";
                // Trigger update
                promptInstructionInput.dispatchEvent(new Event('input', { bubbles: true }));
                await new Promise(resolve => setTimeout(resolve, 250)); // Debounce delay
                assert(assembledPromptPre.textContent.includes("Test instruction"), "Prompt builder updates preview on input");
            } else {
                log('❌ FAIL: Prompt instruction input not found for builder test.', 'fail'); testsFailed++;
            }


            log('\n--- Suite: PromptLibrary (Basic) ---\n', 'suite');
            const categoryFilter = document.getElementById('promptCategoryFilter');
            const promptCardsAfterRender = document.querySelectorAll('#promptListContainer .prompt-card');
            assert(categoryFilter !== null, 'Prompt category filter exists');
            assert(categoryFilter.options.length > 1, 'PromptLibrary category filter populated with options');
            assert(promptCardsAfterRender.length === APP_DATA.PROMPT_LIBRARY_DATA.length, `PromptLibrary renders expected number of prompt cards (${promptCardsAfterRender.length} of ${APP_DATA.PROMPT_LIBRARY_DATA.length})`);
            assert(APP_DATA.PROMPT_LIBRARY_DATA.length >= 140, `Prompt library has at least 140 prompts (found ${APP_DATA.PROMPT_LIBRARY_DATA.length})`);
            
            // Test filter
            if (categoryFilter && APP_DATA.PROMPT_LIBRARY_DATA.length > 0) {
                const firstCategory = APP_DATA.PROMPT_LIBRARY_DATA[0].category;
                categoryFilter.value = firstCategory;
                categoryFilter.dispatchEvent(new Event('change', { bubbles: true }));
                await new Promise(resolve => setTimeout(resolve, 50));
                const filteredCards = document.querySelectorAll('#promptListContainer .prompt-card');
                const expectedFilteredCount = APP_DATA.PROMPT_LIBRARY_DATA.filter(p => p.category === firstCategory).length;
                assert(filteredCards.length === expectedFilteredCount, `Filtering by category "${firstCategory}" worked (expected ${expectedFilteredCount}, got ${filteredCards.length})`);
                categoryFilter.value = 'all'; // Reset filter
                categoryFilter.dispatchEvent(new Event('change', { bubbles: true }));
                await new Promise(resolve => setTimeout(resolve, 50));
            } else {
                log('ℹ️ INFO: Skipping category filter test as data or filter element is insufficient.', 'info');
            }


            logSummary();
        }

        function logSummary() {
            log('\n--- Test Summary ---', 'suite');
            log(`Total tests: ${testsRun}`, 'info');
            log(`Passed: ${testsPassed}`, 'pass');
            log(`Failed: ${testsFailed}`, testsFailed > 0 ? 'fail' : 'pass');
            if (testsFailed === 0) log('🎉 All tests passed!', 'pass');
            else log('💔 Some tests failed. Review logs.', 'fail');
        }
        
        // Run tests when the module loads
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', runTests);
        } else {
            runTests(); // DOM already ready
        }
    </script>

</body>
</html>
